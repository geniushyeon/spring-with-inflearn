# ìŠ¤í”„ë§ DB ì ‘ê·¼ ê¸°ìˆ 
## 2. ìˆœìˆ˜ JDBC

### 2.1. ê´€ë ¨ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€
`build.gradle` íŒŒì¼ì— jdbc, h2 ë°ì´í„°ë² ì´ìŠ¤ ê´€ë ¨ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€.
```gradle
implementation 'org.springframework.boot:spring-boot-starter-jdbc'
runtimeOnly 'com.h2database:h2'
```

### 2.2. ì ‘ì† ì •ë³´ ì¶”ê°€
src/main/resourcesì— ìˆëŠ” application.properties íŒŒì¼ì— ë„£ì–´ì¤€ë‹¤.
```properties
spring.datasource.url=jdbc:h2:tcp://localhost/~/test
spring.datasource.driver-class-name=org.h2.Driver
```
- ì´ë ‡ê²Œ í•˜ë©´ `h2.Driver` ë¶€ë¶„ì— ë¹¨ê°„ ë¶ˆì´ ëœ¨ëŠ”ë°, importê°€ ë˜ì§€ ì•Šì•„ì„œ ê·¸ë ‡ë‹¤.
  - build.gradle íŒŒì¼ì— ëœ¬ ì½”ë¼ë¦¬ ëª¨ì–‘ í´ë¦­<br/>
![](img/day8_jdbc_1.png)<br/>
- ê·¸ëŸ¬ë©´ ì„í¬íŠ¸ë˜ë©´ì„œ ë¹¨ê°„ ë¶ˆë„ ì—†ì–´ì§

### 2.3. JDBCë¡œ êµ¬í˜„ ì‹œì‘

#### 2.3.1. Jdbc í´ë˜ìŠ¤ ì‘ì„±í•˜ê¸°
MemberRepository ì¸í„°í˜ì´ìŠ¤ë¥¼ ë§Œë“¤ì–´ë’€ê¸° ë•Œë¬¸ì—, êµ¬í˜„ì²´ë¥¼ ë§Œë“¤ë©´ ëœë‹¤.
- ğŸ’¡ ì½”ë“œ ìë™ ì •ë ¬: `cmd` + `opt` + `L`
  - ì´í´ë¦½ìŠ¤ë‘ í—·ê°ˆë¦¬ì§€ ë§ì.<br/>
- ì½”ë“œëŠ” ë„ˆë¬´ ê¸¸ì–´ì„œ ìƒëµí•˜ê³  ëª‡ê°€ì§€ ì²´í¬ ì‚¬í•­ë§Œ í•„ê¸°
1. Connection ì–»ì–´ì˜¤ëŠ” ë©”ì†Œë“œ
- JdbcMemberRepository ìƒì„±ì ì•ˆì— ë§Œë“¤ì–´ì¤„ ìˆ˜ë„ ìˆì§€ë§Œ, ê·¸ë ‡ê²Œ ë˜ë©´ í•­ìƒ ìƒˆë¡œìš´ ì»¤ë„¥ì…˜ì´ ë§Œë“¤ì–´ì§„ë‹¤.
- ìŠ¤í”„ë§ í”„ë ˆì„ì›Œí¬ë¥¼ í†µí•´ connectionì„ ì–»ì–´ì˜¬ ë•ŒëŠ” `DataSourceUtils`ë¥¼ í†µí•´ ì–»ì–´ì™€ì•¼ í•œë‹¤.
  - ê·¸ëŸ¬ë©´ ë˜‘ê°™ì€ connectionìœ¼ë¡œ ìœ ì§€ì‹œì¼œì¤€ë‹¤. ìŠ¤í”„ë§ í”„ë ˆì„ì›Œí¬ ì‚¬ìš©í•  ë•ŒëŠ” ê¼­ ì´ë ‡ê²Œ í•´ì¤„ ê²ƒ
```java
import org.springframework.jdbc.datasource.DataSourceUtils;

import javax.sql.DataSource;

private Connection getConnection() {
    return DataSourceUtils.getConnection(dataSource);
    }
```
2. ìì› í•´ì œ(1) - JDBC
- í•­ìƒ ì¼ì¼ì´ ë‹«ì•„ì¤¬ì—ˆëŠ”ë° ì´ë ‡ê²Œ ë©”ì†Œë“œë¡œ ë”°ë¡œ ë¹¼ëŠ” ê²ƒì´ ë” ê¹”ë”í•´ë³´ì´ê³  ì¢‹ì€ ë“¯. ë‹¤ìŒ í”„ë¡œì íŠ¸ì—ì„œëŠ” ì´ë ‡ê²Œ í•´ë³´ë„ë¡ í•˜ì
```java
    private void close(Connection conn, PreparedStatement pstmt, ResultSet rs) {
        try {

            if (rs != null) {
                rs.close();
            }
        } catch (SQLException e) {
            e.printStackTrace();
        }
        try {
            if (pstmt != null) {
                pstmt.close();
            }
        } catch (SQLException e) {
            e.printStackTrace();
        }
        try {
            if (conn != null) {
                close(conn);
            }
        } catch (SQLException e) {
            e.printStackTrace();
        }
    }
```
3. ìì› í•´ì œ(2) - connection ë‹«ì•„ì£¼ê¸°
- getConnection ë•Œì™€ ë§ˆì°¬ê°€ì§€ë¡œ DataSourceUtilsë¥¼ ì´ìš©í•´ ë‹«ì•„ì¤€ë‹¤.
```java
 private void close(Connection conn) throws SQLException {
    DataSourceUtils.releaseConnection(conn, dataSource);
}
```
#### 2.3.2. config í•´ì£¼ê¸°
- SpringConfig í´ë˜ìŠ¤ë¡œ ê°€ì„œ Beanìœ¼ë¡œ `MemoryMemberRepository`ë¥¼ ë“±ë¡í•´ë’€ë˜ ê²ƒì„ `JdbcMemberRepository`ë¡œ ë°”ê¿”ì¤€ë‹¤.
```java
@Bean
public MemberRepository memberRepository() {
//        return new MemoryMemberRepository();
    return new JdbcMemberRepository();
}
```
- âœ”ï¸ ë°˜í™˜í˜• = `ì¸í„°í˜ì´ìŠ¤`, `êµ¬í˜„ì²´ë§Œ ë°”ê¿”ì£¼ëŠ” ê²ƒ` ì²´í¬!
  - ì½”ë“œ ìˆ˜ì • ì—†ì´ configurationë§Œ ë°”ê¾¸ëŠ” ê²ƒ!
- JdbcMemberRepositoryì—ì„œ ìƒì„±ìì˜ ë§¤ê°œë³€ìˆ˜ë¡œ datasourceë¥¼ ì¤¬ê¸° ë•Œë¬¸ì— Configurationì—ë„ ì„¤ì •í•´ì¤˜ì•¼ í•¨.
```java
private DataSource dataSource;

@Autowired
public SpringConfig(DataSource dataSource) {
    this.dataSource = dataSource;
}
```

### 2.4. ì˜ ë˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸
1. cmdì°½ ì—´ì–´ì„œ h2.sh ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸
- ì‹¤í–‰ë˜ì§€ ì•Šì•˜ë‹¤ë©´ `h2/bin`ê¹Œì§€ ë“¤ì–´ê°„ í›„ `./h2.sh` ëª…ë ¹ì–´ ì…ë ¥í•´ì„œ ì‹¤í–‰
2. IntelliJì—ì„œ ì„œë²„ ì‹¤í–‰
![](img/day9_jdbctest.png)<br/>
- íšŒì›ê°€ì…, ëª©ë¡ ì¡°íšŒê¹Œì§€ ì˜ ë˜ëŠ” ê²ƒ í™•ì¸ ì™„ë£Œ!

## 3. ì˜¤ëŠ˜ ë°°ìš´ ë‚´ìš©ì˜ í•µì‹¬
- ê°œë°©-íì‡„ ì›ì¹™(OCP, Open-Closed Principle)
  - í™•ì¥ì—ëŠ” ì—´ë ¤ ìˆê³  ìˆ˜ì • ë° ë³€ê²½ì—ëŠ” ë‹«í˜€ ìˆë‹¤
- Springì˜ DIë¥¼ ì‚¬ìš©í•˜ë©´ `ê¸°ì¡´ ì½”ë“œë¥¼ ì „í˜€ ì†ëŒ€ì§€ ì•Šê³  ì„¤ì •ë§Œìœ¼ë¡œ êµ¬í˜„ í´ë˜ìŠ¤ë¥¼ ë³€ê²½`í•  ìˆ˜ ìˆë‹¤.