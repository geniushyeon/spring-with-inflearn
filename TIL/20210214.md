# AOP
# 1. AOPê°€ í•„ìš”í•œ ìƒí™©
- ëª¨ë“  ë©”ì†Œë“œì˜ í˜¸ì¶œ ì‹œê°„ì„ ì¸¡ì •í•˜ê³  ì‹¶ë‹¤ë©´?
- ê³µí†µ ê´€ì‹¬ ì‚¬í•­(cross-cutting concern) vs í•µì‹¬ ê´€ì‹¬ ì‚¬í•­(core concern)
- íšŒì› ê°€ì… ì‹œê°„, íšŒì› ì¡°íšŒ ì‹œê°„ì„ ì¸¡ì •í•˜ê³  ì‹¶ë‹¤ë©´?
## 1.1. AOPë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  ì¼ì¼ì´ ì“´ë‹¤ë©´..
```java
public Long join(Member member) {
    long start = System.currentTimeMillis();

    try {

        validateDuplicatedMember(member); // ì¤‘ë³µ íšŒì› ê²€ì¦
        memberRepository.save(member);

        return member.getId();
    } finally {
        long finish = System.currentTimeMillis();
        long timeMs = finish - start;
        System.out.println("join: " + timeMs + "ms");
    }

}
```
- ì´ëŸ° ì½”ë“œë¥¼ ëª¨ë“  ë©”ì†Œë“œì— ì¨ì•¼ í•¨.. ë©”ì†Œë“œê°€ 1000ê°œë©´ 1000ê°œ ëª¨ë‘ì—..

## 1.2. ë¬¸ì œ
- íšŒì›ê°€ì…, íšŒì› ì¡°íšŒì—ì„œ ì‹œê°„ì„ ì¸¡ì •í•˜ëŠ” ê¸°ëŠ¥ì€ í•µì‹¬ ê´€ì‹¬ ì‚¬í•­ì´ ì•„ë‹Œ `ê³µí†µ ê´€ì‹¬ ì‚¬í•­`
- ì‹œê°„ ì¸¡ì • ë¡œì§ + í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ ì„ì—¬ ìœ ì§€ë³´ìˆ˜ê°€ ì–´ë ¤ì›€
- ì‹œê°„ ì¸¡ì • ë¡œì§ì„ ë³„ë„ì˜ ê³µí†µ ë¡œì§ìœ¼ë¡œ ë§Œë“¤ê¸° ë§¤ìš° ì–´ë ¤ì›€
- ì‹œê°„ ì¸¡ì • ë¡œì§ì„ ë³€ê²½í•  ë•Œ ëª¨ë“  ë¡œì§ì„ ì°¾ì•„ê°€ë©° ë³€ê²½í•´ì•¼ í•¨

# 2. AOP ì ìš©
- AOP: Aspected Oriented Programming(ê´€ì  ì§€í–¥ í”„ë¡œê·¸ë˜ë°)
- ê³µí†µ ê´€ì‹¬ì‚¬ì™€ í•µì‹¬ ê´€ì‹¬ì‚¬ë¥¼ ë¶„ë¦¬ -> ì›í•˜ëŠ” ê³³ì— ê³µí†µ ê´€ì‹¬ ì‚¬í•­ ì ìš©

## 2.1. ì‹¤ìŠµ
1. aop íŒ¨í‚¤ì§€ë¥¼ ë§Œë“  í›„, ì‹œê°„ ì¸¡ì • ë¡œì§ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ì¤€ë‹¤.
```java
package hello.hellospring.aop;

import org.aspectj.lang.ProceedingJoinPoint;
import org.aspectj.lang.annotation.Aspect;

@Aspect
public class TimeTraceAop {

    public Object execute(ProceedingJoinPoint joinPoint) throws Throwable {

        long start = System.currentTimeMillis();
        System.out.println("START: " + joinPoint.toString());

        try {
            return joinPoint.proceed();

        } finally {
            long finish = System.currentTimeMillis();
            long timeMs = finish - start;
            System.out.println("END: " + joinPoint.toString() + " " + timeMs + "ms");
        }
    }
}
```
- `@Aspect` ì–´ë…¸í…Œì´ì…˜ ë‹¬ì•„ì£¼ê¸°
- joinPoint: AOPê°€ ì‹¤í–‰ë˜ëŠ” ì‹œì 

2. SpringConfigë¡œ ê°€ì„œ Beanì— ë“±ë¡í•´ì¤€ë‹¤.
```java
@Bean
public TimeTraceAop timeTraceAop() {
    return new TimeTraceAop();
}
```
ë˜ëŠ”
- TimeTraceAop í´ë˜ìŠ¤ë¥¼ ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº”
  - `@Component` ì–´ë…¸í…Œì´ì…˜ ë‹¬ì•„ì£¼ê¸°

3. (!ì¤‘ìš”) execute ë©”ì†Œë“œ ìœ„ì— `@Around` ì–´ë…¸í…Œì´ì…˜ ë‹¬ì•„ì£¼ê¸°
```java
@Around("execution(* hello.hellospring..*(..))")
public Object execute(ProceedingJoinPoint joinPoint) throws Throwable {

    long start = System.currentTimeMillis();
    System.out.println("START: " + joinPoint.toString());

    try {
        return joinPoint.proceed();

    } finally {
        long finish = System.currentTimeMillis();
        long timeMs = finish - start;
        System.out.println("END: " + joinPoint.toString() + " " + timeMs + "ms");
    }
}
```
- hello.hellospring í•˜ìœ„ì— ìˆëŠ” ëª¨ë“  íŒ¨í‚¤ì§€, ëª¨ë“  ë©”ì†Œë“œ, ëª¨ë“  íŒŒë¼ë¯¸í„°ì— ëŒ€í•´ ì ìš©í•˜ë¼

4. ì„œë²„ ë„ì›Œì„œ í™•ì¸í•˜ë©´
- ì½˜ì†”ì°½ì— ì •ìƒì ìœ¼ë¡œ sysoutëœë‹¤.<br/>
![](img/20210214_aoptest1.png)

- ğŸ’¡ `cmd + opt + L` : (ë§¨ë‚  í—·ê°ˆë¦¬ëŠ”) ì½”ë“œ ìë™ ì •ë ¬

## 2.2. í•´ê²°
1. í•µì‹¬ ê´€ì‹¬ì‚¬(íšŒì›ê°€ì…, íšŒì› ì¡°íšŒ ë“±)ì™€ ê³µí†µ ê´€ì‹¬ì‚¬(ì‹œê°„ ì¸¡ì •)ë¥¼ ë¶„ë¦¬
2. ì‹œê°„ ì¸¡ì • ë¡œì§ì„ ë³„ë„ì˜ ê³µí†µ ë¡œì§ìœ¼ë¡œ ë§Œë“¦
3. í•µì‹¬ ê´€ì‹¬ì‚¬ë¥¼ ê¹”ë”í•˜ê²Œ ìœ ì§€ + ë³€ê²½ì´ í•„ìš”í•˜ë©´ ê³µí†µ ê´€ì‹¬ì‚¬ ë¡œì§ë§Œ ë³€ê²½í•˜ë©´ ë¨
4. ì›í•˜ëŠ” ì ìš© ëŒ€ìƒì„ ì„ íƒí•  ìˆ˜ ìˆìŒ(`í¬ì¸íŠ¸ì»· í‘œí˜„ì‹`ì—ì„œ ì„¤ì •)

## 2.3. ë™ì‘ ë°©ì‹
- AOP ì ìš© ì „: memberControllerì—ì„œ memberServiceë¥¼ ì§ì ‘ ë¶€ë¦„
- AOP ì ìš© í›„: í”„ë¡ì‹œ(ê°€ì§œ) memberServiceë¥¼ ë¨¼ì € í˜¸ì¶œ -> `joinPoint.proceed()`ë  ë•Œ ì° memberService í˜¸ì¶œ
  - MemberControllerì—ì„œ MemberService DIí•˜ëŠ” ë¶€ë¶„ì— ì•„ë˜ ì½”ë“œë¥¼ ì¶”ê°€í•¨ìœ¼ë¡œì¨ í™•ì¸ ê°€ëŠ¥.
```java
@Autowired
public MemberController(MemberService memberService) {
    this.memberService = memberService;
    System.out.println("memberService = " + memberService.getClass());
}
```
- ì„œë²„ ì‹¤í–‰ ê²°ê³¼<br/>
![](img/20210214_aoptest2.png)<br/>
- MemberService ë’¤ì— ë¸”ë¼ë¸”ë¼ë¸”ë¼ ë¶™ì–´ ìˆìŒ
  - MemberServiceë¥¼ ë³µì œí•´ì„œ ì½”ë“œë¥¼ ì¡°ì‘í•˜ëŠ” ê¸°ìˆ 