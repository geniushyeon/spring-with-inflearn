# íšŒì› ê´€ë¦¬ ì˜ˆì œ - ë°±ì—”ë“œ ê°œë°œ

## 1. ë¹„ì¦ˆë‹ˆìŠ¤ ìš”êµ¬ì‚¬í•­ ì •ë¦¬
- ë°ì´í„°: íšŒì›ID, ì´ë¦„
- ê¸°ëŠ¥: íšŒì› ë“±ë¡, ì¡°íšŒ

### 1.1. ì¼ë°˜ì ì¸ ì›¹ ì–´í”Œë¦¬ì¼€ì´ì…˜ ê³„ì¸µ êµ¬ì¡°
- Controller: ì›¹ MVCì˜ ì»¨íŠ¸ë¡¤ëŸ¬ êµ¬í˜„
- Service: í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ êµ¬í˜„
- Repository: ë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ê·¼, ë„ë©”ì¸ ê°ì²´ë¥¼ DBì— ì €ì¥í•˜ê³  ê´€ë¦¬
- Domain: ë¹„ì¦ˆë‹ˆìŠ¤ ë„ë©”ì¸ ê°ì²´

## 2. íšŒì› ë„ë©”ì¸ / ë¦¬í¬ì§€í† ë¦¬ ë§Œë“¤ê¸°
- Domain: Member.java
```java
package hello.hellospring.domain;

public class Member {

    private Long id;
    private String name;

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }
}
```
- Repository: ì¸í„°í˜ì´ìŠ¤ë¡œ ë§Œë“¤ê³ , í–¥í›„ ì¸í„°í˜ì´ìŠ¤ì˜ êµ¬í˜„ì²´ë¥¼ ë§Œë“ ë‹¤.
- Optional<T>
  - Java 8ì— ë“¤ì–´ê°„ ê¸°ëŠ¥.
  - nullì„ ë°˜í™˜í•  ë•Œ Optionalë¡œ ê°ì‹¸ì„œ ë°˜í™˜í•  ìˆ˜ ìˆìŒ.
```java
package hello.hellospring.repository;

import hello.hellospring.domain.Member;

import java.util.List;
import java.util.Optional;

public interface MemberRepository {
    // insert
    Member save(Member member);
    // select
    Optional<Member> findById(Long id);
    Optional<Member> findByName(String name);
    List<Member> findAll();

}
```
- MemoryMemberRepository.java
  - MemberRepositoryì˜ êµ¬í˜„ì²´

```java
package hello.hellospring.repository;

import hello.hellospring.domain.Member;

import java.util.*;

public class MemoryMemberRepository implements MemberRepository {

    // ë™ì‹œì„± ë¬¸ì œ ë•Œë¬¸ì— ì‹¤ë¬´ì—ì„  ë‹¤ë¥¸ ë°©ë²•ì´ ì“°ì„. ìµœëŒ€í•œ ê°„ë‹¨í•œ ë°©ë²•ìœ¼ë¡œ
    private static Map<Long, Member> store = new HashMap<>();
    private static long sequence = 0L;

    @Override
    public Member save(Member member) {
        member.setId(++sequence);
        store.put(member.getId(), member);

        return member;
    }

    @Override
    public Optional<Member> findById(Long id) {
        return Optional.ofNullable(store.get(id));
    }

    // ëŒë‹¤ ê³µë¶€ í•„ìš”..
    @Override
    public Optional<Member> findByName(String name) {
        return store.values().stream()
                .filter(member -> member.getName().equals(name))
                .findAny();
    }

    @Override
    public List<Member> findAll() {
        return new ArrayList<>(store.values());
    }
}
```

## 3. í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì‘ì„±í•˜ê¸°
- ë‚´ê°€ ë§Œë“  ì½”ë“œê°€ ì •ìƒ ì‘ë™í•˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•œ ì½”ë“œ.
- ìë°”ì˜ main ë©”ì†Œë“œë¥¼ í†µí•´ ì‹¤í–‰í•˜ê±°ë‚˜ ì›¹ ì–´í”Œë¦¬ì¼€ì´ì…˜ì˜ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ í†µí•´ í•´ë‹¹ ê¸°ëŠ¥ì„ ì‹¤í–‰
  - 1) ì¤€ë¹„í•˜ëŠ” ë° ì˜¤ë˜ ê±¸ë¦¬ê³  2) ë°˜ë³µ ì‹¤í–‰í•˜ê¸° ì–´ë µê³  3) ì—¬ëŸ¬ í…ŒìŠ¤íŠ¸ë¥¼ í•œë²ˆì— ì‹¤í–‰í•˜ê¸° ì–´ë µë‹¤ëŠ” ë‹¨ì ì´ ìˆìŒ.
  - `JUnit`ì´ë¼ëŠ” í”„ë ˆì„ì›Œí¬ë¡œ í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ë©´ ì´ëŸ¬í•œ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆìŒ.

1. `src/test/java` ì•„ë˜ì— ìƒì„±í•œë‹¤.
2. `í…ŒìŠ¤íŠ¸í• í´ë˜ìŠ¤ì´ë¦„` + Test.java
3. êµ³ì´ publicìœ¼ë¡œ ì•ˆí•´ë„ ë¨.
4. Test method ìœ„ì— `@Test` ì–´ë…¸í…Œì´ì…˜ ë¶™ì—¬ì£¼ê¸°

### 3.1. save, findById í…ŒìŠ¤íŠ¸
- MemoryMemberRepositoryTest.java
```java
package hello.hellospring.repository;

import hello.hellospring.domain.Member;
import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.Test;

class MemoryMemberRepositoryTest {

    MemoryMemberRepository repository = new MemoryMemberRepository();

    @Test
    public void save() {
        Member member = new Member();
        member.setName("spring");

        repository.save(member);

        Member result = repository.findById(member.getId()).get();
        Assertions.assertEquals(member, result);
    }

}
```
- Assertions.assertEquals(member, result);
  - org.junit.jupiter.api.Assertions íŒ¨í‚¤ì§€ì— ìˆìŒ
  - save ë©”ì†Œë“œë¡œ ë„£ì€ ë©¤ë²„ì™€ repositoryì—ì„œ êº¼ë‚¸ member(=result)ê°€ ê°™ì€ì§€ í™•ì¸í•´ì¤˜
  - ì‚¬ìš© ë°©ë²•: Assertions.assertEquals(ê¸°ëŒ€í•˜ëŠ” ê°’, ì‹¤ì œ ê°’)
- ê²°ê³¼<br/>
![screenshot](img/day4_testsuccess.png)
- ì•„ë¬´ ì¼ë„ ì•ˆ ì¼ì–´ë‚œ ê²ƒ ê°™ì§€ë§Œ ì½”ë“œë¥¼ ì‚´ì§ ë°”ê¿”ì„œ ì‹¤í–‰í•´ë³´ë©´
```java
Assertions.assertEquals(member, null);
```
![screenshot](img/day4_testfailed.png)<br/>
- ì‹¤íŒ¨í–ˆë‹¤ê³  ì˜ ëœ¸.

#### 3.1.1. ë˜ë‹¤ë¥¸ ë°©ë²•
- org.assertj.core.apiì— ìˆëŠ” Assertions ì‚¬ìš©í•˜ê¸°
```java
import org.assertj.core.api.Assertions;

Assertions.assertThat(member).isEqualTo(result);
```
- ë¬¸ë²•ì´ ì¢€ ë” ì§ê´€ì ì´ë‹¤.
- ì‹¤ë¬´ì—ì„œëŠ” ë¹Œë“œ íˆ´ê³¼ ì—®ì–´ì„œ í…ŒìŠ¤íŠ¸ê°€ ì‹¤íŒ¨í•˜ë©´ ë‹¤ìŒ ë‹¨ê³„ë¡œ ëª» ë„˜ì–´ê°€ê²Œë” í•œë‹¤.

### 3.2. findByName í…ŒìŠ¤íŠ¸
- ğŸ’¡ Rename ë‹¨ì¶•í‚¤: `Shift + F6`
  - keycron í‚¤ë³´ë“œì—ì„œëŠ” `Shift + Fn2 + 6`

```java
@Test
public void findByName() {
    Member member1 = new Member();
    member1.setName("lee");
    repository.save(member1);

    Member member2 = new Member();
    member2.setName("yoon");
    repository.save(member2);

    Member result = repository.findByName("lee").get();

    Assertions.assertThat(result).isEqualTo(member1);
    }
```

### 3.3. í´ë˜ìŠ¤ ë ˆë²¨ì—ì„œ í…ŒìŠ¤íŠ¸í•˜ê¸°
- ë©”ì†Œë“œ ë ˆë²¨ì´ ì•„ë‹ˆë¼ í´ë ˆìŠ¤ ë ˆë²¨ì—ì„œ í…ŒìŠ¤íŠ¸í•´ë³¼ ìˆ˜ ìˆë‹¤.<br/>
![screenshot](./img/day4_classtest.png)


### 3.4. findAll í…ŒìŠ¤íŠ¸í•˜ê¸°
```java
@Test
public void findAll() {
    Member member1 = new Member();
    member1.setName("lee");
    repository.save(member1);

    Member member2 = new Member();
    member2.setName("yoon");
    repository.save(member2);

    List<Member> result = repository.findAll();

    Assertions.assertThat(result.size()).isEqualTo(2);

    }
```

### 3.5. ì „ì²´ ì½”ë“œ ì‘ì„± í›„ í´ë˜ìŠ¤ ë ˆë²¨ì—ì„œ í…ŒìŠ¤íŠ¸
![screenshot](img/day4_alltestfailed.png)<br/>
- findAll()ì´ ì‹¤í–‰ë˜ê³  findByName()ì´ ì‹¤í–‰ë˜ì—ˆëŠ”ë°, ë‘ ë©”ì†Œë“œì—ì„œ ê²¹ì¹˜ëŠ” ë°ì´í„°ê°€ ìˆê¸° ë•Œë¬¸ì— ì˜¤ë¥˜ê°€ ë‚˜ëŠ” ê²ƒ.
- í…ŒìŠ¤íŠ¸ ìˆœì„œëŠ” ë³´ì¥í•  ìˆ˜ ì—†ìŒ.
  - ë•Œë¬¸ì— í•œ í…ŒìŠ¤íŠ¸ê°€ ëë‚˜ë©´ ë°ì´í„°ë¥¼ clearí•´ì¤˜ì•¼ í•œë‹¤.
  - `@AfterEach` ì–´ë…¸í…Œì´ì…˜ì„ ë¶™ì—¬ì£¼ë©´ ê° í…ŒìŠ¤íŠ¸ ì½”ë“œê°€ ëë‚œ í›„ ë¬´ì¡°ê±´ ê·¸ ë©”ì†Œë“œë¥¼ ì‹¤í–‰í•˜ê²Œ ëœë‹¤.

1. MemoryMemberRepository í´ë˜ìŠ¤ì— ë°ì´í„°ë¥¼ ë¹„ìš¸ ìˆ˜ ìˆëŠ” ë©”ì†Œë“œë¥¼ ë¨¼ì € ë§Œë“¤ì–´ì¤€ë‹¤.
```java
// Mapì˜ clear() ë©”ì†Œë“œ
public void clearStore() {
    store.clear();
}
```

2. í…ŒìŠ¤íŠ¸ ì½”ë“œì— 1ë²ˆ ë©”ì†Œë“œë¥¼ ê°€ì ¸ì˜¨ afterEach ë©”ì†Œë“œë¥¼ ë§Œë“¤ì–´ì¤€ë‹¤.
```java
@AfterEach
public void afterEach() {
    repository.clearStore();
}
```

3. ë‹¤ì‹œ í…ŒìŠ¤íŠ¸í•´ë³¸ë‹¤.
![screenshot](img/day4_alltestsuccess.png)<br/>
- ì„±ê³µ

#### í…ŒìŠ¤íŠ¸ ì£¼ë„ ê°œë°œ
- í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë¥¼ ë¨¼ì € ë§Œë“  í›„ ë©”ì¸ ì½”ë“œë¥¼ ë§Œë“œëŠ” ê²ƒ