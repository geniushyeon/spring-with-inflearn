# ìŠ¤í”„ë§ ë¹ˆ ë“±ë¡í•˜ê¸°

## 1. ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº”ê³¼ ìë™ ì˜ì¡´ê´€ê³„ ì„¤ì •

### 1.1. MemberController ë§Œë“¤ê¸°
`@Controller` ì–´ë…¸í…Œì´ì…˜ì´ ë¶™ìœ¼ë©´ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì—ì„œ ê´€ë¦¬í•¨.
```java
@Controller
public class MemberController {
    private final MemberService memberService = new MemberService();
    ...
}
```
ì´ëŸ° ì‹ìœ¼ë¡œ new ì—°ì‚°ìë¥¼ ì´ìš©í•´ ìƒì„±í•´ì¤„ ìˆ˜ë„ ìˆì§€ë§Œ, ìŠ¤í”„ë§ì´ ê´€ë¦¬í•˜ê²Œ ë˜ë©´ ì „ë¶€ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ë“±ë¡í•˜ì—¬ ì»¨í…Œì´ë„ˆë¡œë¶€í„° ë°›ì•„ ì™€ì„œ ì“°ë„ë¡ ë°”ê¿”ì¤˜ì•¼ í•¨.
- ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ë”± í•˜ë‚˜ë§Œ(`Singleton`) ë“±ë¡í•´ì„œ ì‚¬ìš©
  - ë”°ë¼ì„œ ê°™ì€ ìŠ¤í”„ë§ ë¹ˆì´ë©´ ëª¨ë‘ ê°™ì€ ì¸ìŠ¤í„´ìŠ¤ì„.
  -  `@Autowired`: ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì— ë“±ë¡ë˜ì–´ ìˆëŠ” Beanê³¼ ì—°ê²°ì‹œì¼œì¤Œ.


```java
package hello.hellospring.controller;

import hello.hellospring.service.MemberService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;

@Controller
public class MemberController {

    private final MemberService memberService;

    @Autowired // ìƒì„±ìë¥¼ í†µí•œ DI
    public MemberController(MemberService memberService) {
        this.memberService = memberService;
    }
}
```
ì‹¤í–‰ì‹œì¼œë³´ë©´
```text
Parameter 0 of constructor in hello.hellospring.controller.MemberController required a bean of type 'hello.hellospring.service.MemberService' that could not be found.
```
- ìŠ¤í”„ë§ ë¹ˆì— MemberServiceê°€ ë“±ë¡ë˜ì–´ ìˆì§€ ì•Šê¸° ë•Œë¬¸ì— ì˜¤ë¥˜ ë°œìƒ
  - MemberService í´ë˜ìŠ¤ì— `@Service` ì–´ë…¸í…Œì´ì…˜ ì¶”ê°€
### 1.2. MemberService.java ìˆ˜ì •
```java
package hello.hellospring.service;

import hello.hellospring.domain.Member;
import hello.hellospring.repository.MemberRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import java.util.List;
import java.util.Optional;

@Service // ì–´ë…¸í…Œì´ì…˜ ì¶”ê°€
public class MemberService {

    private final MemberRepository memberRepository;

    @Autowired // ìƒì„±ìë¥¼ í†µí•œ ì£¼ì…
    public MemberService(MemberRepository memberRepository) {
        this.memberRepository = memberRepository;
    }

    /*
     * íšŒì›ê°€ì…
     * */
    public Long join(Member member) {
        validateDuplicatedMember(member); // ì¤‘ë³µ íšŒì› ê²€ì¦
        memberRepository.save(member);

        return member.getId();
    }

    private void validateDuplicatedMember(Member member) {
        memberRepository.findByName(member.getName())
                .ifPresent(m -> {
                    throw new IllegalStateException("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” íšŒì›ì…ë‹ˆë‹¤.");
                });
    }

    /*
    * ì „ì²´ íšŒì› ì¡°íšŒ
   * */
    public List<Member> findMembers() {
        return memberRepository.findAll();
    }

    public Optional<Member> findOne(Long memberId) {
        return memberRepository.findById(memberId);
    }

}
```

### 1.3. Annotation ì‚´í´ë³´ê¸°
- ğŸ’¡ cmd + @Service ì–´ë…¸í…Œì´ì…˜ í´ë¦­í•˜ë©´ ì •ë³´ë¥¼ ë³¼ ìˆ˜ ìˆìŒ(í•´ë‹¹ í´ë˜ìŠ¤ë¡œ ì´ë™.)
```java
package org.springframework.stereotype;

import java.lang.annotation.Documented;
import java.lang.annotation.ElementType;
import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;
import java.lang.annotation.Target;

import org.springframework.core.annotation.AliasFor;

@Target({ElementType.TYPE})
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Component
public @interface Service {

	/**
	 * The value may indicate a suggestion for a logical component name,
	 * to be turned into a Spring bean in case of an autodetected component.
	 * @return the suggested component name, if any (or empty String otherwise)
	 */
	@AliasFor(annotation = Component.class)
	String value() default "";

}

```
- `@Component` ì–´ë…¸í…Œì´ì…˜ì´ ë¶™ìœ¼ë©´ ìŠ¤í”„ë§ì—ì„œ ê´€ë¦¬í•œë‹¤.
  - `@Repository`, `@Controller`ë„ ë§ˆì°¬ê°€ì§€

### 1.4. ì•„ë¬´ë°ë‚˜ ì–´ë…¸í…Œì´ì…˜ì„ ë¶™ì—¬ë„ ë˜ëŠ”ê°€?
src/main/java í•˜ìœ„ì— demo íŒ¨í‚¤ì§€ë¥¼ ë§Œë“¤ê³ , Demo.java í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì—ˆë‹¤ê³  ê°€ì •í•´ë³´ì.
```java
@Service
public class Demo {
    ...
}
```
- ê²°ë¡ ë¶€í„° ë§í•˜ë©´ ì•ˆ ë¨.<br/>
![screenshot](img/day6_packages.png)<br/>
- hello/hellospring íŒ¨í‚¤ì§€ì˜ HelloSpringApplication.javaì—ì„œë¶€í„° ìŠ¤í”„ë§ì´ ì‹œì‘ë˜ëŠ” ê²ƒì´ê¸° ë•Œë¬¸ì— ìƒìœ„ì— íŒ¨í‚¤ì§€ë¥¼ ë§Œë“¤ê³  ë¹ˆìœ¼ë¡œ ë“±ë¡í•´ë„ ì¸ì‹í•  ìˆ˜ ì—†ë‹¤.
  - hello.hellospring í•˜ìœ„ íŒ¨í‚¤ì§€ì— ìˆì–´ì•¼ ìŠ¤í”„ë§ì´ ê´€ë¦¬í•¨.
```java
package hello.hellospring;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class HelloSpringApplication {

	public static void main(String[] args) {
		SpringApplication.run(HelloSpringApplication.class, args);
	}

}
```
## 2. ìë°” ì½”ë“œë¡œ ì§ì ‘ ìŠ¤í”„ë§ ë¹ˆ ë“±ë¡í•˜ê¸°
ì•ì„œ ë“±ë¡í–ˆë˜ `@Autowired`, `@Service`, `@Repository` ì–´ë…¸í…Œì´ì…˜ ì œê±°í•œ í›„ ì‹œì‘
```java
package hello.hellospring;

import hello.hellospring.repository.MemberRepository;
import hello.hellospring.repository.MemoryMemberRepository;
import hello.hellospring.service.MemberService;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class SpringConfig {

    @Bean
    public MemberService memberService() {
        return new MemberService();
    }

}

```
- return new MemberService(ì—¬ê¸°);ì— íŒŒë¼ë¯¸í„°ê°€ ì—†ì–´ ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤.
  - ğŸ’¡ `cmd + P` : í˜„ì¬ ìœ„ì¹˜í•œ ë©”ì†Œë“œì˜ íŒŒë¼ë¯¸í„° ì •ë³´ ì¡°íšŒ
  - ì•„ë˜ìª½ì— MemberRepositoryë¥¼ Beanìœ¼ë¡œ ë“±ë¡í•˜ê³  ê·¸ ë¹ˆì„ ê°€ì ¸ì˜´.
```java
package hello.hellospring;

import hello.hellospring.repository.MemberRepository;
import hello.hellospring.repository.MemoryMemberRepository;
import hello.hellospring.service.MemberService;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class SpringConfig {

    @Bean
    public MemberService memberService() {
        return new MemberService(memberRepository());
    }

    @Bean
    public MemberRepository memberRepository() {
        return new MemoryMemberRepository();
    }
}
```
### 2.1. ì°¸ê³ ì‚¬í•­
- XMLë¡œ ì„¤ì •í•˜ëŠ” ë°©ë²•ë„ ìˆì§€ë§Œ ìµœê·¼ì—ëŠ” ì˜ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ.
- DIì˜ ì¢…ë¥˜
  - 1) í•„ë“œ ì£¼ì… - ë³„ë¡œ ì•ˆ ì¢‹ìŒ
  - 2) setter ì£¼ì… - ì–˜ë„ ë³„ë¡œ ì•ˆ ì¢‹ìŒ: ì•„ë¬´ ê°œë°œìë‚˜ í˜¸ì¶œí•  ìˆ˜ ìˆìŒ..
  - 3) ìƒì„±ì ì£¼ì… âœ”ï¸
  - ì„¸ ê°€ì§€ ë°©ë²•ì´ ìˆëŠ”ë°, ì˜ì¡´ ê´€ê³„ê°€ ì‹¤í–‰ ì¤‘ì— ë™ì ìœ¼ë¡œ ë³€í•˜ëŠ” ê²½ìš°ëŠ” ê±°ì˜ ì—†ìœ¼ë¯€ë¡œ ìƒì„±ì ì£¼ì…ì„ ê¶Œì¥

```java
@Controller
public class MemberController {
    // í•„ë“œ ì£¼ì…
    @Autowired private MemberService memberService;

    // setter ì£¼ì…
    @Autowired
    public void setMemberService(MemberService memberService) {
        this.memberService = memberService;
    }
}
```
- ì‹¤ë¬´ì—ì„œëŠ” ì£¼ë¡œ ì •í˜•í™”ëœ ì»¨íŠ¸ë¡¤ëŸ¬, ì„œë¹„ìŠ¤, ë¦¬í¬ì§€í† ë¦¬ ê°™ì€ ì½”ë“œëŠ” `ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº”`ì„ ì‚¬ìš©í•œë‹¤. ê·¸ë¦¬ê³  ì •í˜•í™”ë˜ì§€ ì•Šê±°ë‚˜, ìƒí™©ì— ë”°ë¼ êµ¬í˜„ í´ë˜ìŠ¤ë¥¼ ë³€ê²½í•´ì•¼ í•˜ë©´ `ì„¤ì •`ì„ í†µí•´ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡í•œë‹¤.
  - ex) ì²˜ìŒì— DBë‘ ì—°ê²°ì„ í•˜ì§€ ì•Šì•˜ë‹¤ê°€ DB ì—°ê²°ì„ í•´ì„œ êµ¬í˜„ í´ë˜ìŠ¤ë¥¼ ë³€ê²½í•´ì•¼ í•˜ëŠ” ê²½ìš°